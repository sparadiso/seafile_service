{% extends "organizations/org_admin_sidebar.html" %}
{% load seahub_tags i18n %}
{% block cur_log %}tab-cur{% endblock %}

{% block right_panel %}
<div class="tabnav ovhd">
    <ul class="tabnav-tabs fleft">
        <li class="tabnav-tab tabnav-tab-cur"><a href="{% url 'org_log_file_audit' %}">{% trans "File Access" %}</a></li>
        <li class="tabnav-tab"><a href="{% url 'org_log_file_update' %}">{% trans "File Update" %}</a></li>
        <li class="tabnav-tab"><a href="{% url 'org_log_perm_audit' %}">{% trans "Permission" %}</a></li>
    </ul>
</div>

{% if events %}
<table>
  <tr>
    <th width="23%">{% trans "User" %}</th>
    <th width="12%">{% trans "Type" %}</th>
    <th width="17%">{% trans "IP" %}</th>
    <th width="13%">{% trans "Date" %}</th>
    <th width="15%">{% trans "Library" %}</th>
    <th width="20%">{% trans "File" %}</th>
  </tr>

  <div id="audit-unselect-op">
      {% if user_selected %}
          <div id="audit-unselect-user" title="unselect {{ user_selected }}"><a href="#">{{user_selected}}</a><span>&#10006</span></div>
      {% endif %}
      {% if repo_selected %}
          <div id="audit-unselect-repo" title="unselect {{ events.0.repo.name }}"><a href="#">{{events.0.repo.name}}</a><span>&#10006</span></div>
      {% endif %}
  </div>

  {% for e in events %}
  <tr class="audit-item">
    <td>
        {% if e.user %}
            {% if e.is_org_user %}
                <a href="{% url 'org_user_info' e.user %}">{{ e.user }} </a>
                {% if not user_selected %}
                    <span class="more-op-icon sf2-icon-caret-down op-icon vh"></span>
                    <ul class="audit-select-hidden hide">
                    <li><a class="audit-select-user" href="#" data-email="{{ e.user }}">{% trans "Only Show"%} <strong>{{ e.user }}</strong></a></li>
                    </ul>
                {% endif %}
            {% else %}
                <span>{{ e.user }}</span>
            {% endif %}
        {% else %}
            <span>{% trans "Anonymous User" %}</span>
        {% endif %}
    </td>
    <td>
    {% if 'web' in e.etype %}
        <span>web</span>
    {% elif 'api' in e.etype %}
        <span class="cspt" title="{{ e.device }}">API</span>
    {% elif 'share-link' in e.etype %}
        <span>share-link</span>
    {% else %}
        <span>{{ e.etype }}</span>
    {% endif %}
    </td>

    <td>{{ e.ip }}</td>
    <td>{{ e.time|date:"Y-m-d G:i:s" }}</td>
    <td>
        {% if e.repo.name %}
        <span>{{ e.repo.name }} </span>
            {% if not repo_selected %}
                <span class="more-op-icon sf2-icon-caret-down op-icon vh"></span>
                <ul class="audit-select-hidden hide">
                <li><a class="audit-select-repo" href="#" data-repo_id="{{ e.repo.id }}">{% trans "Only Show"%} <strong>{{ e.repo.name }}</strong></a></li>
                </ul>
            {% endif %}
        {% else %}
        <strong>Deleted</strong>
        {% endif %}
    </td>
    <td><span class="cspt" title="{{ e.file_path }}">{{ e.filename }}</span></td>
  </tr>
  {% endfor %}
</table>
{% include "sysadmin_log_paginator.html" %}
{% else %}
<div class="empty-tips">
    <h2 class="alc">{% trans "No File Audit Infomation" %}</h2>
</div>
{% endif %}

{% endblock %}

{% block extra_script %}
<script type="text/javascript">
{% include "sysadmin_log_js.html" %}
</script>
{% endblock %}

